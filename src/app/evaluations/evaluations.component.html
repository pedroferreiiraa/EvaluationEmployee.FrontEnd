<div class="container mx-auto px-4 py-8">
  <h2 class="text-3xl font-semibold text-gray-800 mb-6">Avaliações por Departamento</h2>

  <!-- Itera sobre os departamentos -->
  <div *ngFor="let department of departments" class="mb-4">
    <div class="bg-gray-100 rounded-lg shadow p-4">
      <div class="flex justify-between items-center">
        <h3 class="text-xl font-semibold text-blue-600">{{ department.name }}</h3>
        <button (click)="toggleDepartment(department.id)" class="text-gray-500 hover:text-gray-700">
          <svg *ngIf="!isExpanded(department.id)" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
          </svg>
          <svg *ngIf="isExpanded(department.id)" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Exibe as avaliações do departamento ao expandir -->
    <div *ngIf="isExpanded(department.id)" class="mt-2 bg-white shadow rounded-lg p-4">
      <div *ngFor="let user of department.users">
        <!-- Itera sobre as avaliações do usuário -->
        <div *ngFor="let evaluation of evaluationsByUser[user.id]" class="p-3 border-b border-gray-200">
          <p class="text-sm text-gray-500">Colaborador: {{ user.fullName }}</p>
          <p class="text-sm text-gray-500">Concluído em: {{ evaluation.completedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
          <p>Status: <span [ngClass]="{'text-green-600': evaluation.status === 4, 'text-red-600': evaluation.status !== 4}">
            {{ evaluation.status === 4 ? 'Completa' : 'Incompleta' }}
          </span></p>
          <button (click)="goToEvaluationDetails(evaluation.avaliationId)" class="mt-2 text-blue-500 hover:underline">
            Ver Detalhes
          </button>
        </div>
      </div>

      <!-- Mensagem caso não haja avaliações no departamento -->
      <p *ngIf="!hasEvaluationsInDepartment(department)" class="text-sm text-gray-500">
        Nenhuma avaliação encontrada para este departamento.
      </p>
    </div>
  </div>
</div>
